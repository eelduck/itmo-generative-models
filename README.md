# Глубокие генеративные модели

Репозиторий с домашними заданиями курса __Глубокие генеративные модели__ в ITMO AI Talent Hub

Автор: __Азаматов Ильдар Русланович (@eelduck)__

Домашние задания находятся в отдельных ветках:
- homework_1
- homework_2
- ...

# ДЗ 3 Сэмплинг StyleGAN

Решение всех трёх частей заданяия находятся в ноутбуке [notebooks/stylegan.ipynb](notebooks/stylegan.ipynb)

## Проекция изображений в латентное пространство

Были взяты по 2 фотографии четырех личностей:
- Валерий Бабушкин
- Коби Брайант
- Владимир Путин
- Азамат Мусагалиев

Изначальные приближения вектора в латентном пространстве были взяты с помощью энкодера e4e_ffhq. Дальнейший поиск проекции в латентном пространстве производится в классе [ImageProjector](src/image_projector.py)

Параметры оптимизации:
```python
num_steps=100,
learning_rate=0.01,
reg_w = 5e5,  # вес регуляризации
rec_w = 0.5,  # вес Reconstruction Loss 
lpips_w = 1,  # вес Perceptual Loss
optimizer = torch.optim.Adam
```

В качестве результата имеем следующие отображения:
![alt text](image.png)

Отображения получились вполне похожими на оригинал, хоть и были упущены некоторые детали по типу текстуры кожи, морщин и волос

## Перенос стиля

Перед тем,, как проецировать стили на изображения, необходимо найти их проекции в латентном пространстве. Были выбраны 3 стиля и их представления представлены ниже:
![alt text](image-1.png)

Для переноса стиля был использован метод смешивания двух представлений - исходного изображения и стиля.
- В векторе W+ были смешаны индексы с 9 по 17 (те, что отвечают за цвет, стиль, но не за саму форму лица)
- psi = 0.1 

Результаты переноса стиля:
![alt text](image-2.png)

## Перенос эмоций

Для переноса эмоций был использован тот же метод, что и при переносе стиля.
Однако латентные представления эмоций я заранее нашёл в репозитории https://github.com/a312863063/generators-with-stylegan2

Были взяты 3 эмоции для теста:
- Счастье
- Удивление
- Злость

Параметры переноса:
- В векторе W+ были смешаны индексы с 4 по 9
- psi = 0.7
- Вес, с которым брался вектор эмоций - 15. Если брать меньше, эмоция не сильно проявлена, если больше - появляются артефакты на изображениях

Результаты переноса эмоций:
![alt text](image-3.png)
Можем заметить, что эмоция удивления не очень легла почти на всех персонажей, особенно странными получились глаза на фотографиях. Подозреваю, что сам латентный вектор был не очень качественный

## Перенос лица

Для переноса лица использовался тот же поиск по латентному пространству, однако в лосс был добавлен еще один компонент - Arcface Loss

Параметры оптимизации:
```python
num_steps=100,
learning_rate=0.01,
reg_w = 5e5,  # вес регуляризации
rec_w = 1,  # вес Reconstruction Loss 
lpips_w = 2,  # вес Perceptual Loss
arcface_w = 1,  # вес Arcface Loss
optimizer = torch.optim.Adam
```

Матрица переносов:
![alt text](image-4.png)

Почти на всех изображениях можно заметить, что заменилось только лицо, цвет кожи и выражение лица осталось прежним.

P.S. Кажется раскрыт секрет мема

![alt text](image-5.png)